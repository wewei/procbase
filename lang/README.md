# @procbase/lang 模块测试

这个目录包含了 TypeScript 语言分析模块的测试文件，使用 bun 作为测试运行器。

## 测试文件说明

### 1. SymbolExtractor.test.ts
使用 bun test 的符号提取测试，包括：
- ✅ 函数声明提取
- ✅ 类声明提取
- ✅ 接口声明提取
- ✅ 类型别名提取
- ✅ 变量声明提取
- ✅ 导入声明提取
- ⏭️ 依赖关系计算（已跳过，需要真实文件系统支持）

### 2. DependencyTest.ts
使用 bun test 的依赖关系分析测试，包括：
- ⏭️ 跨文件依赖关系（已跳过，需要真实文件系统支持）
- ⏭️ 循环依赖检测（已跳过，需要真实文件系统支持）
- ⏭️ 实际项目场景模拟（已跳过，需要真实文件系统支持）

### 3. test-simple.ts
简单的依赖关系验证测试，可以直接运行：
```bash
bun run test-simple.ts
```

## 运行测试

### 安装依赖
```bash
bun install
```

### 运行所有测试
```bash
bun test
```

### 运行特定测试
```bash
# 运行符号提取测试
bun test SymbolExtractor.test.ts

# 运行依赖关系测试
bun test DependencyTest.ts

# 运行简单验证测试
bun run test-simple.ts
```

## 测试状态说明

### ✅ 已通过的测试
- 单文件符号提取（函数、类、接口、类型别名、变量、导入声明）
- 符号信息提取（名称、类型、位置等）

### ⏭️ 已跳过的测试
- 跨文件依赖关系检测
- 循环依赖检测
- 复杂项目场景的依赖分析

### 跳过原因
当前测试环境使用 in-memory 文件系统，TypeScript 编译器无法正确解析模块间的符号关联。跨文件依赖测试需要：

1. **真实文件系统支持**：将测试文件写入磁盘
2. **正确的模块解析**：让 TypeScript 能够解析 `import` 语句
3. **符号关联**：建立跨文件的符号引用关系

### 未来改进
- 使用临时文件系统进行集成测试
- 实现真实的模块解析器
- 添加端到端的依赖分析测试

## 测试输出说明

测试会输出详细的依赖关系信息，包括：
- 每个符号的依赖列表
- 符号闭包的大小和内容
- 跨文件依赖的检测结果

这些信息可以帮助我们排查依赖关系计算的问题。

## 使用 bun 的优势

- 内置 TypeScript 支持，无需额外配置
- 快速的测试运行速度
- 简洁的测试 API
- 内置断言库 